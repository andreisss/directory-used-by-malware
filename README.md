# directory-used-by-malware

We have a string of directories under this category that is used by applications to store user-specific data. 
Some of these folders, like AppData and Roaming, are used by malware to copy themselves into these folders and execute them from these folders.

The following lists some of the folders where <user> is your user login account name.
  
•••My Documents C:\Users\<user>\Documents
  
•••Desktop C:\Users\<user>\Desktop
  
•••AppData C:\Users\<user>\AppData
  
•••Roaming C:\Users\<user>\AppData\Roaming

  
  Some of these paths like the AppData and Roaming are hidden by Windows and are
not visible unless you enable the option to show hidden files and folders as described in
the “Show Hidden Files and Folders”

•••Registry:
 The registry is stored on disk in the folder C:\Windows\System32\config\ in the DEFAULT, SAM, SECURITY, SOFTWARE, SYSTEM files.
The NTUSER.dat file stores registry data, located at C:\Users\<user name>\ntuser.dat.
 This file stores registry information that is specific to the logged-in user. ntuser.dat
is a protected operating system file, and to view it, you need to enable Viewing Protected
Operating System Files in Folder Options.
  
From a malware analysis perspective, if you see a process
that has one of the names that match any of the OS system programs or more, verify the
path of the program to make sure it is located in the directory C:\Windows\system32. If
it is any other directory, most likely, the process is malicious, masquerading itself as a system process.

  
Command Line for Bulk Extractor Tool to Extract Packet Captures for the Network Connections from the Memory Dumps
bulk_extractor32.exe -x all -e net -o <directory_to_store_pcaps> <path_to_memory_dump>
  
•••Process Image Path
This is the path of the program from which the process is created. By default, the binaries
of the system processes should be in C:\Windows\system32. Now we know that the
system32 folder contains OS system processes. While analyzing malware, if you find a
process that has the name of an OS system process, but with an image file path that is not
in the C:\Windows\system32 folder, you should treat it as suspicious and investigate it
further.
  
![image description](https://i.ibb.co/L8GPVcL/parent-rpcoess.png)
  
  
  Most of the system processes have only one instance executing at any point in time.
The only exception to this is csrss.exe, which has two instances running. Another
is svchost.exe, which can have multiple instances running. So svchost.exe is a soft
target for malware. A lot of malware names itself svchost.exe, with the idea that its
process gets lost among clean instances and thereby escapes detection by the user/
analyst.
  
•••Command-Line Tools to Register a Service
  
- sc.exe create SNAME start= auto binpath= <path_to_service_exe> where, SNAME is the name of the new service
- regsvr32.exe <path_to_service_dll>
  
  
  ![image description](https://i.ibb.co/pJ1bL0D/uservskernel.png)
  
  
 Winlogon
The Winlogon.exe process is responsible for taking care of the user logging in to the
system. It is responsible for starting processes that the user needs after logon. These
programs that are started by WinLogon are placed under the registry key HKLM\
Software\Microsoft\WindowsNT\CurrentVersion\Winlogon. The names under this
KEY that hold the programs that WinLogon starts are Userinit, Shell, and Notify.
  
   ![image description](https://i.ibb.co/H7SXJYR/userinit.png)

 
  Debuggers
To facilitate software developers to debug applications, Microsoft provides various
options in the registry that allows one to open an application under the control of a
debugger. Let’s go through some of these options made available by Microsoft.
Image File Execution Option (IFEO)
IFEO is a popular debugging facility made available on Windows as a key at HKLM\ SOFTWARE\Microsoft\WindowsNT\CurrentVersion\Image file execution options.
To use this facility, you need to add a value to the application key they want to debug at the
registry key location. As an exercise, open the registry key location. In most cases, you should have a
subkey called iexplore.exe at the key. If not, you can create a new subkey called iexplore.exe. Now let’s create a string value for the iexplore.exe key located under
Image File Execution Options. You can do this by right-clicking the iexplore.exe key ➤
New ➤ String Value. Then set a new name-value, where the name is Debugger, and its value is C:\windows\system32\calc.exe, which is the Calculator application.
  
 Figure 8-20
shows how it looks after setting this value. This sets up our application iexplore.exe or
rather the Internet Explorer browser to be debugged by calc.exe.
  
![image description](https://i.ibb.co/30wV8Dj/debugger.png)

